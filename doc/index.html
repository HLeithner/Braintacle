<!--
Braintacle main documentation

$Id$

Copyright (C) 2011,2012 Holger Schletz <holger.schletz@web.de>

This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
more details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Braintacle documentation</title>
</head>
<body>

<h1>Braintacle documentation</h1>

<h2>Project website</h2>

<p>
Braintacle is hosted at <a href="http://savannah.nongnu.org/projects/braintacle">http://savannah.nongnu.org/projects/braintacle</a>.
</p>


<h2>What is it?</h2>

<p>
Braintacle is a set of applications for automatic inventory of hard- and software, software deployment and more.
It consists of several parts:
</p>
<ul>
<li>
A patched version of <a href="http://ocsinventory-ng.org">OCS Inventory NG</a> with several improvements,
most notably the support for different database backends (PostgreSQL is recommended, but MySQL is still supported).
It is contained in the <em>ocsinventory</em> directory. See the
<a href="http://svn.savannah.nongnu.org/viewvc/*checkout*/trunk/ocsinventory/README.html?root=braintacle">README.html</a>
file in the same directory for details.
</li>
<li>
An alternative administration console which is aimed to replace the original administration console (ocsreports) completely.
It is not feature complete yet, but already fully usable for most everyday tasks.
</li>
<li>
Some command line helper applications.
</li>
</ul>

<h2>Advantages</h2>

<ul>
<li>
Better integration into your IT infrastructure.
Use the DBMS of your choice &ndash; no need to maintain an extra MySQL installation if you already have a
different DBMS set up.
The installation is less intrusive to your server.
No more code is copied to obscure locations.
All code is run directly from 1 application directory, making maintenance much easier.
</li>
<li>
The package builder is much easier to use and provides features that the original console does not have.
Most notably, deploying a new version of an existing package is very easy:
just click on its name, upload the file, give it a new name and that's it.
See "<a href="#packagebuilder">Package builder</a>" for a full list of features.
</li>
<li>
Duplicates are much better to manage.
You can specify which type of information to merge, and you can blacklist asset tags too, not only serials and MAC addresses.
</li>
<li>
Multiple packages can be deployed to a single computer in one step.
</li>
<li>
Software listings can be freed of clutter like these boring Windows updates and annoying Office 2007 subpackages.
See "<a href="#softwarefilter">software filter</a>" for details.
</li>
<li>
Software dictionaries are much easier to manage.
Extra categories are not supported yet &ndash; The dictionary manager is intended for software filters only.
</li>
<li>
In addition to the automatically collected Windows license key, a key can be entered manually.
This can be useful if the reported key is garbage (this can happen in certain situations)
or if licenses have been reassigned within an organization.
</li>
<li>
Consistent navigation &ndash; no popups, no more lost menus.
<li>
Computers can be exported as XML, either individually via console or all at once via the <a href="#export.php">export tool</a>.
The XML files are similar to those generated locally by the agents, and suitable for import via the console or the ocsinventory-injector.pl script.
This simplifies data migration between different databases or data processing via external tools.
</li>
<li>
Braintacle uses localization functions wherever possible.
Translation is provided by the well-known <a href="http://www.gnu.org/software/gettext/">gettext</a> standard.
English and german translations are included.
Other translations can easily be added and maintained using your favorite gettext tools.
</li>
<li>
As a side-effect of the Zend Framework's MVC architecture, the model classes provide an abstract API to all logical
objects (computers, packages etc.) which can be used by third party code.
</li>
</ul>


<h2>Extra features and limitations</h2>

<h3>Login restrictions</h3>

<p>
Braintacle does not implement different access privileges.
To prevent unprivileged users from unauthorized access, only administrators can log in.
</p>
<p>
Braintacle requires an account with an MD5 hashed password.
This is the default when creating an account or changing the password.
If the database is populated with the bundled OCSInventory console or schema-manager.php, the default account will already have a hashed password.
A cleartext 'admin' passord will be converted.
</p>

<h3><a name="packagebuilder">Package builder</a></h3>

<h4>Editing packages</h4>

<p>
Braintacle's most notable feature is the ability to edit existing packages.
More precisely, by clicking on the name of a package you invoke the package builder with the old package's metadata already filled in.
The package content itself does not get copied to the new package, so you have to upload a file again.
This limitation is OK for the typical scenario where you deploy a new software version, so you would have to upload a new file anyway.
</p>
<p>
After the new package has been successfully built, it will optionally be deployed to computers which already had the old package marked for deployment.
Then the old package is deleted.
For this reason, the new package needs a different name (typically a different version number appended) because for a brief period of time, both packages exist and package names have to be unique.
If anything goes wrong with building the new package, the old package will not be touched.
</p>

<h4>Additional metadata</h4>

<p>
You can specify a comment and a certificate path.
Both fields are already present in the database and the certificate path is really evaluated, but the original GUI always submits hardcoded defaults (empty comment and 'INSTALL_PATH/cacert.pem').
INSTALL_PATH will be expanded to the agent's installation directory
(like '%PROGRAMFILES%\Ocs Inventory Agent').
You can set any path and filename you like.
The Windows agent also accepts UNC paths (which will probably only work if all clients reside on a local network and the share allows guest access).
This allows some cool stuff like changing the HTTPS server's certificate without breaking deployment.
</p>

<h4>On-the-fly ZIP compression</h4>

<p>
If you want to deploy a single file, having to wrap it into a ZIP archive before uploading can be annoying.
Braintacle creates the archive on the fly if the uploaded file is not a ZIP archive (currently only implemented for Windows packages).
Since the PHP Zip extension's capabilities are limited and ressource usage can grow high for huge files, you can bypass this feature by creating the archive manually before upload, like you always did.
</p>

<h4>Computation of fragment size</h4>

<p>
The original GUI allows specifying both the number of fragments and the fragment size.
Changing one value automatically affects the other.
Braintacle simplifies this process a bit, assuming that you don't want to have a package to have a particular number of fragments, but any number of fragments up to a certain size.
You only specify the maximum fragment size (a default can be provided).
The actual size may be lower because Braintacle splits the package into evenly-sized fragments up to the given limit.
</p>
<p>
Since the maximum fragment size is not stored anywhere (except for the default which may not apply to existing packages), it has to be estimated upon editing.
The result will almost certainly be different from the original value, but still about the same magnitude.
In particular, it would deliver the same number of fragments if the size of the new file had not changed.
</p>

<h4>Upload size limit</h4>

<p>
Braintacle will try to prevent you from uploading a file that is too big to handle.
This is more user-friendly than seeing the script abort prematurely and having to look at the logfiles to find out which one of PHP's limits had been exceeded.
</p>
<p>
The maximum allowed file size is displayed within the package builder.
If this value is too low, adjust the PHP settings.
It is the smallest value of these PHP settings:
</p>
<ul>
<li>100% of upload_max_filesize</li>
<li>90% of post_max_size</li>
<li>80% of memory_limit</li>
</ul>

<h4>Only 1 download server supported</h4>

<p>
Braintacle supports only 1 download server.
This simplifies not only the code, but also the workflow.
The code is written with the assumption that there is only 1 download server per package.
<strong>Having more than 1 download server can give unpredictable results. Use at your own risk!</strong>
<p>
If ressource usage is a problem on your server, you should consider solving the problem outside the application.
For example, you could force usage of a caching proxy on external sites or set up a load balancer.
Once set up this may be easier to handle than having to deal with this everytime you build a new package.
</p>

<h4>Automatic activation</h4>

<p>
The limitation to 1 download server allows package creation and activation to be merged into a single step.
The download locations must be specified at build time, where defaults can be provided.
</p>

<h4>Secure hashes</h4>

<p>
Since MD5 hashes are insecure, SHA1 hashes are used instead.
This is already supported by the agent, but the OCS GUI does not make use of this feature.
</p>

<h4>More reliable connection testing</h4>

<p>
The HTTP and HTTPS connections are checked without using fopen() wrappers.
These checks now work even if allow_url_fopen is disabled.
</p>
<p>
Note that success or failure of these tests does not necessarily mean that the download will or will not work.
Different proxy configuration, firewalls and name resolution may give a different result on the client.
The test results only indicate success or failure on the server that runs Braintacle.
It's up to you to interpret the results.
</p>

<h3><a name="softwarefilter">Software filter</a></h3>

<p>
OCS Inventory provides a function called "software dictionaries" where pieces of installed software can be tagged to be ignored.
This is intended for interaction with <a href="http://www.glpi-project.org/spip.php?lang=en">GLPI</a>.
The OCS Inventory console only provides an interface to define these lists, but does not make use of it.
</p>
<p>
Braintacle honours this list and does not display any software which is tagged to be ignored.
If you already use GLPI and make use of this feature, this behavior might not be desired.
There is an option to display all software anyway.
</p>
<p>
Some software (like MS Office 2007) causes multiple identical entries in a computer's inventory.
These duplicate entries are hidden by default, but can be shown with a single mouseclick if you are really interested.
</p>

<h3>Network management (aka IP discovery)</h3>

<p>
Braintacle uses a different method to determine which network a computer belongs to.
In particular, it takes the netmask into account (for example, 192.168.0.0/16 is different from 192.168.0.0/24)
and also ignores 127.0.0.0/8 completely as this is not a real network.
Additionally, interfaces belonging to an inventoried computer will never show up as unknown, even if the inventory is out of date.
</p>

<h3>Installing packages on a computer</h3>

<p>
Multiple packages can be deployed to a computer at once instead of picking them one by one.
This is particularly convenient for fresh installs where a lot of packages have to be installed.
</p>
<p>
The list of installable packages does not contain already installed packages, which would only end up with ERR_ALREADY_SETUP.
If a package is not in the list, it would not be installable anyway.
This also keeps the list as short as possible.
</p>

<h3>Managing duplicates</h3>

<p>
Braintacle supports a blacklist for asset tags, in addition to serials and MAC addresses.
</p>
<p>
The implementation for merging duplicates is more robust &ndash; no more database errors on weird combinations.
</p>
<p>
The information to be merged can be specified in detail:
</p>
<ul>
<li>
User defined information, if selected, will be preserved from the oldest entry.
</li>
<li>
Manual group assignments, if selected, will be combined from all older entries.
</li>
<li>
Package assignments, if selected, will be combined from all older entries.
The package history is intentionally not preserved.
The typical origin of duplicates is a reinstall, where this would just get in the way.
</li>
</ul>


<h2>Known issues</h2>

<h3>Apache gives 404 error on certain operations</h3>

<p>
These strange 404 errors come directly from Apache.
They don't even show up in the error log.
</p>
<p>The source of this problem is the <a href="http://httpd.apache.org/docs/2.2/mod/core.html#allowencodedslashes">AllowEncodedSlashes</a> directive.
If this is disabled (the default), URLs which contain encoded slashes (%2F) trigger this 404.
</p>
<p>
I have not found any information about the purpose of this behavior and the consequences of changing it.
I suppose this is a lame attempt to stop path traversal attacks on poorly written scripts.
</p>
<p>
There are several ways to work around this problem at application level, but they are all very messy.
For this reason, I have not implemented any and the only way to solve this problem is to set <code>AllowEncodedSlashes On</code> for the virtual host.
</p>

<h2>Managing the database</h2>

<p>
There are 2 use cases that require different methods for database management.
</p>

<h3>Using Braintacle in addition to an original OCS Inventory NG installation</h3>

<p>Use the OCS Inventory installer to manage the database.
<strong>Do not use Braintacle's schema manager.</strong>
</p>

<h3>Using Braintacle with its bundled communication server</h3>

<p>
Braintacle manages the database with the script tools/schema-manager.php.
Please note that Braintacle's schema is slightly different from the original schema.
See the
<a href="http://svn.savannah.nongnu.org/viewvc/*checkout*/trunk/schema/README.html?root=braintacle">schema documentation</a>
for details.
</p>
<p>
<strong>
This schema is not fully compatible with the original version of OCS Inventory NG.
It can only be used with the communication server that comes bundled with Braintacle.
Do not use schema-manager.php if you use a non-Braintacle server.
Manage the schema through the original console application in that case.
</strong>
</p>
<p>
The schema manager checks for compatibility with the original version and refuses to update the database in that case.
This can be overridden with the --force option, but compatibility will be lost.
</p>
<p>
Braintacle and its bundled communication server work with both schema types,
but some features will only be available with the Braintacle schema.
</p>

<h4>Creating the database</h4>

<p>
This is documented in the installation instructions for the communication server.
See
<a href="http://svn.savannah.nongnu.org/viewvc/*checkout*/trunk/ocsinventory/README.html?root=braintacle">ocsinventory/README.html</a>
for details.
</p>

<h4>Updating the database</h4>

<p>
When the schema has changed, just run the schema manager again.
It will update the tables to the new schema.
It's strongly recommend to back up the database before you do this.
Updating a database with MDB2_Schema is a complex operation.
Despite intensive testing and bugfixing, there could always something go wrong.
</p>
<p>
It is safe to run the schema manager more than once, even if the schema has not changed.
It's strongly recommended to run it after every application upgrade.
The script will detect if a schema upgrade is required and perform it, or abort if not.
</p>


<h2>Helper applications</h2>

<p>
The tools directory contains some scripts that are not part of the application, but intended to be invoked directly via command line when needed.
</p>

<h3>schema-manager.php</h3>

<p>
This script is described above.
</p>

<h3><a name="export.php">export.php</a></h3>

<p>
This script exports all computers in the database to the directory specified via the --dir or -d argument.
It will generate 1 XML file per computer.
The generated files can optionally be validated via the --validate or -v switch.
</p>

<h3>createpackage.php</h3>
<p>
This script creates a package from the command line.
This is useful if a file is too big to be uploaded to the webserver.
It can also be used as part of a package builder script.
</p>
<p>
It is limited to the package builder defaults.
Only the name and the file itself can be specified.
</p>
<p>
Don't forget to change permissions/ownership of the generated directory and files.
Otherwise the webserver won't be able to read and/or delete them.
You could also use <code>su</code> to run this script with the UID of the webserver:
</p>
<pre>
su -c 'php tools/createpackage-php PackageName install-Package.exe' www-data
</pre>
<p>
The script is also an example for using the Braintacle API in a different application.
</p>

<h3>update-translation.php</h3>

<p>
This script can be used to maintain the translation files.
It requires xgettext, msgmerge and msgfmt in your search path.
It does 3 things:
</p>

<ol>
<li>
It extracts all translatable strings from the PHP source files and updates languages/braintacle.pot.
This operation can be skipped by passing the <code>--noextract</code> option.<br>
By default, the update is done only if changes to the strings are detected.
If only line numbers have changed, nothing is done in this stage.
An update can be forced with the <code>--force</code> option.
</li>
<li>It updates all .po files in languages/&lt;language&gt;/.</li>
<li>It compiles the .po files to .mo files in languages/&lt;language&gt;/LC_MESSAGES/ which are used by the application.</li>
</ol>

<p>
Run this script everytime you have added translatable stings to the source code or when you have updated the translation.
</p>

<h3>generate-documentation.php</h3>

<p>
This script generates/updates the API documentation.
It requires <a href="http://www.phpdoc.org/">phpDocumentor 2</a> to be installed.
It will not work with older phpDocumentor versions.
</p>
<p>
If no argument is given, phpDocumentor is invoked via the 'phpdoc' command.
If this is not available or a different version (a development snapshot, for
example) should be used, specify the path to the phpDocumentor installation:
<p><code>
php tools/generate-documentation.php /path/to/phpDocumentor2
</code></p>

</body>
</html>
